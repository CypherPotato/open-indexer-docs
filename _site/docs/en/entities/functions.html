<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Functions | Open Indexer </title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="title" content="Functions | Open Indexer ">


        <link rel="icon" href="../../../assets/img/favicon.ico">
        <link rel="stylesheet" href="../../../public/docfx.min.css">
        <link rel="stylesheet" href="../../../public/main.css">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
        <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@100..900&family=Geist:wght@100..900&display=swap" rel="stylesheet">
        
        <link href="https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.css" rel="stylesheet">

        <meta name="docfx:navrel" content="../../../toc.html">
        <meta name="docfx:tocrel" content="../toc.html">

        <meta name="docfx:rel" content="../../../">


        <meta name="docfx:docurl" content="https://github.com/CypherPotato/open-indexer-docs/blob/master/docs/en/entities/functions.md/#L1">
        <meta name="loc:inThisArticle" content="In this article">
        <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
        <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
        <meta name="loc:tocFilter" content="Filter by title">
        <meta name="loc:nextArticle" content="Next">
        <meta name="loc:prevArticle" content="Previous">
        <meta name="loc:themeLight" content="Light">
        <meta name="loc:themeDark" content="Dark">
        <meta name="loc:themeAuto" content="Auto">
        <meta name="loc:changeTheme" content="Change theme">
        <meta name="loc:copy" content="Copy">
        <meta name="loc:downloadPdf" content="Download PDF">
        
        <script type="module" src="./../../../public/docfx.min.js"></script>
        <script>
            const theme = localStorage.getItem('theme') || 'auto';
            document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
        </script>
        
        <script src="https://unpkg.com/@cypherpotato/el/dist/el.min.js"></script>
                
        <script>            
            function switchLanguage(lang) {
                const docPart = window.location.pathname.match(/\/docs\/((en)\/)?(.*)/)[3];
                const newPath = lang + docPart;
                window.location.href = window.location.origin + newPath;
            }        
        </script>
        
    </head>
    
    
    <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
        <header class="bg-body border-bottom">
            <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
                <div class="container-xxl flex-nowrap">
                    <a class="navbar-brand" href="../../../index.html">
                        <img id="logo" class="svg" src="../../../assets/img/Icon.png" alt="Open Indexer">
                        Open Indexer
                    </a>
                    <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
                        <i class="bi bi-three-dots"></i>
                    </button>
                    <div class="collapse navbar-collapse" id="navpanel">
                        <div id="navbar">
                            <form class="search" role="search" id="search">
                                <i class="bi bi-search"></i>
                                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
                            </form>
                        </div>
                    </div>
                </div>
            </nav>
        </header>

        <main class="container-xxl">
            <div class="toc-offcanvas">
                <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
                    <div class="offcanvas-header">
                        <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                        <nav class="toc" id="toc"></nav>
                    </div>
                </div>
            </div>

            <div class="content">
                <div class="actionbar">
                    <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
                        <i class="bi bi-list"></i>
                    </button>

                    <nav id="breadcrumb"></nav>

                    <div id="language-wrapper">
                        <a class="btn border-0 dropdown-toggle show" data-bs-toggle="dropdown" aria-expanded="true" title="Change theme">
                            <i class="bi bi-globe"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end language-dropdown">
                            <li>
                                <a class="dropdown-item" href="javascript:switchLanguage('/docs/')">
                                    <img src="/assets/flag/brazil.png">
                                    Português
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="javascript:switchLanguage('/docs/en/')">
                                    <img src="/assets/flag/usa.png">
                                    English
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <article data-uid="">
<h1 id="functions">Functions</h1>

<p>Functions are a way to force your model to process information using JSON as an intermediate communication medium. With functions, you can make any model respond in the JSON format you want.</p>
<p>It can be useful for categorizing comments, applying moderation to reviews, or processing information with the help of AI.</p>
<p>Currently, it is only possible to use functions with models provided by Open Indexer.</p>
<h2 id="calling-a-function">Calling a Function</h2>
<p>To call an AI function, you will need to inform what the AI should respond with and provide a JSON schema that it should follow.</p>
<p>Less intelligent models tend to fail to generate JSON, resulting in an invalid or problematic document. To fix this, adjust your model, instruction, and attempt parameter if necessary.</p>
<p>You are charged for each attempt the AI makes to generate a response. Slightly more intelligent models tend to generate correct results on the first attempt. It is guaranteed that a valid JSON will be generated, but it is not guaranteed that the model will follow the names and types provided by your JSON schema.</p>
<p>Additionally, you can opt to activate <strong>internet search</strong> for function calls. This option can be useful for bringing relevant data in real-time to structure your response. When activating this option, you are charged for each internet search, with a fixed cost of <strong>$0.012</strong> American dollars per query.</p>
<p>An internal model decides which searches should be performed based on the instructions and input data provided, which is also charged at a low cost. Alternatively, you can specify the <code>searchTerms</code> parameter manually to avoid calling the internal model to obtain the search terms.</p>
<p>Specifying fewer search results is also possible and can help reduce the number of tokens processed by the AI model, and consequently, the cost of the operation.</p>
<p>Retry attempts to generate the JSON content do not search the internet again and do not call the internal model to create the questions.</p>
<h4 id="request">Request</h4>
<div class="request-item post">
    <span>POST</span>
    <span>
        /api/v1/functions/json
    </span>
</div>
<pre><code class="lang-json">{
    // Specify the name of the integrated model to be used for the action.
    &quot;modelName&quot;: &quot;@metaai/llama-3.1-8b&quot;,
    
    // Explain what your model should do with the input and how it should provide the response.
    &quot;instructions&quot;: &quot;Classify the user's comment, indicating whether it is positive or negative, and if it contains any relevant information (a number between 0 (not relevant) and 10 (very relevant))&quot;,
    
    // The JSON object that the model should generate. You can provide generation examples in the instructions field. This object must be a valid JSON in the API.
    // This object must be an object, an array, or a string.
    &quot;responseSchema&quot;: {
        &quot;feedbackType&quot;: &quot;neutral | positive | negative&quot;,
        &quot;informationScore&quot;: 5
    },
    
    // Optional. Defines a JSON input for the model. Can be any type of JSON value.
    &quot;inputData&quot;: {
        &quot;userComment&quot;: &quot;Terrible market. There's a guard inside watching you so you don't steal and the butchers ignore you and serve pretty girls in front of you. But thank God there are other markets coming and the end of this circus will arrive&quot;
    },
    
    // Optional. Defines how many attempts the model should make before the API returns an error. Must be a number between 1 and 30.
    &quot;maxAttempts&quot;: 10,
    
    // Optional. Defines the time limit in seconds to obtain a valid JSON before the API returns an error. Must be a number between 1 and 3600 (one hour).
    &quot;timeout&quot;: 300,
    
    // Optional. Allows the model to perform an internet search to improve the response construction.
    &quot;webSearch&quot;: {

        // Enables or disables internet search for the function.
        &quot;enabled&quot;: true,

        // Defines the search terms that will be performed to complement the model. Leave empty for an internal model to automatically generate the search terms.
        &quot;searchTerms&quot;: [],

        // Maximum number of results per search term that will be attached to the generation context.
        &quot;maxResultsPerTerm&quot;: 5
    }
}
</code></pre>
<h4 id="response">Response</h4>
<pre><code class="lang-json">{
    &quot;message&quot;: null,
    &quot;data&quot;: {
        // The result contains the object defined in &quot;responseSchema&quot;, with the fields filled in by the AI
        &quot;result&quot;: {
            &quot;feedbackType&quot;: &quot;negative&quot;,
            &quot;informationScore&quot;: 8
        },
        
        // Which attempt the AI was able to generate a valid JSON
        &quot;attempt&quot;: 1,
        
        // The time in milliseconds to obtain a valid JSON
        &quot;elapsedMilliseconds&quot;: 527
    }
}
</code></pre>
<h2 id="examples">Examples</h2>
<p>Check out examples of AI functions for various everyday tasks:</p>
<h4 id="summarize-order-and-classify-if-it-requires-attention-or-not">Summarize order and classify if it requires attention or not</h4>
<div class="request-item post">
    <span>POST</span>
    <span>
        /api/v1/functions/json
    </span>
</div>
<pre><code class="lang-json">{
    &quot;modelName&quot;: &quot;@metaai/llama-4-scout-17b&quot;,
    &quot;instructions&quot;: &quot;Summarize the user's comment, creating a short description with a maximum of 10 words indicating what they want to do. Also, indicate whether this comment requires attention or not.&quot;,
    &quot;responseSchema&quot;: {
        &quot;shortSummary&quot;: &quot;...&quot;,
        &quot;requiresAttention&quot;: false
    },
    &quot;inputData&quot;: &quot;The customer Fernando de Castro has been trying to contact support since Friday and says he will cancel if he doesn't speak to someone today. He also said he is a friend of Rebeca from the commercial and is threatening to speak badly about the company on TikTok. Please, can someone attend to this guy??&quot;
}
</code></pre>
<pre><code class="lang-json">{
    &quot;message&quot;: null,
    &quot;data&quot;: {
        &quot;result&quot;: {
            &quot;shortSummary&quot;: &quot;Customer wants contact with support to avoid cancellation and threatens&quot;,
            &quot;requiresAttention&quot;: true
        },
        &quot;attempt&quot;: 1,
        &quot;elapsedMilliseconds&quot;: 639
    }
}
</code></pre>
<h4 id="bring-latest-news-and-weather-for-a-specific-city">Bring latest news and weather for a specific city</h4>
<div class="request-item post">
    <span>POST</span>
    <span>
        /api/v1/functions/json
    </span>
</div>
<pre><code class="lang-json">{
    &quot;modelName&quot;: &quot;@google/gemini-1.5-flash-8b&quot;,
    &quot;instructions&quot;: &quot;You are a model that searches for the last five news for the city the user informs. Create a short title for each news and details of what it covers. Also, bring weather data for the searched city.&quot;,
    &quot;responseSchema&quot;: {
        &quot;latestNews&quot;: [
            {
                &quot;title&quot;: &quot;...&quot;,
                &quot;details&quot;: &quot;...&quot;,
                &quot;link&quot;: &quot;https://...&quot;
            }
        ],
        &quot;weather&quot;: {
            &quot;currentTemperature&quot;: 0,
            &quot;weatherType&quot;: &quot;sunny | cloudy | rain | thunderstorm&quot;,
            &quot;willRain&quot;: true
        }
    },
    &quot;inputData&quot;: {
        &quot;city&quot;: &quot;São José do Rio Preto&quot;
    },
    &quot;webSearch&quot;: {
        &quot;enabled&quot;: true
    }
}
</code></pre>
<pre><code class="lang-json">{
    &quot;message&quot;: null,
    &quot;data&quot;: {
        &quot;result&quot;: {
            &quot;latestNews&quot;: [
                {
                    &quot;title&quot;: &quot;Aid arrested for shooting at ex-girlfriend&quot;,
                    &quot;details&quot;: &quot;An aid was arrested suspected of shooting with a shotgun at his ex-girlfriend and her ex-partner in the Ypê neighborhood, in Ilha Solteira (SP). The woman was rescued and taken to the Regional Hospital, where she underwent surgery.&quot;,
                    &quot;link&quot;: &quot;https://g1.globo.com/sp/sao-jose-do-rio-preto-aracatuba/&quot;
                },
                {
                    &quot;title&quot;: &quot;Rio Preto doctors form society with mentorships&quot;,
                    &quot;details&quot;: &quot;Doctors from Rio Preto officially formed a society with mentorship companies.&quot;,
                    &quot;link&quot;: &quot;https://www.gazetaderiopreto.com.br/&quot;
                },
                {
                    &quot;title&quot;: &quot;Land regularization guarantees property in Rio Preto&quot;,
                    &quot;details&quot;: &quot;A land regularization project guarantees security for Rio Preto residents.&quot;,
                    &quot;link&quot;: &quot;https://regional24horas.com.br/rio-preto&quot;
                },
                {
                    &quot;title&quot;: &quot;Petrobras reduces diesel price&quot;,
                    &quot;details&quot;: &quot;Petrobras reduced the diesel price starting this Tuesday (6).&quot;,
                    &quot;link&quot;: &quot;https://www.gazetaderiopreto.com.br/&quot;
                },
                {
                    &quot;title&quot;: &quot;Third lane construction on Washington Luís begins&quot;,
                    &quot;details&quot;: &quot;The construction of the third lane on Washington Luís begins this Monday.&quot;,
                    &quot;link&quot;: &quot;https://www.gazetaderiopreto.com.br/&quot;
                }
            ],
            &quot;weather&quot;: {
                &quot;currentTemperature&quot;: 26,
                &quot;weatherType&quot;: &quot;cloudy&quot;,
                &quot;willRain&quot;: true
            }
        },
        &quot;attempt&quot;: 1,
        &quot;elapsedMilliseconds&quot;: 7480,
        &quot;searchedTerms&quot;: [
            &quot;weather in São José do Rio Preto&quot;,
            &quot;news São José do Rio Preto and region&quot;
        ]
    }
}
</code></pre>

</article>

                <div class="contribution d-print-none">
                    <a href="https://github.com/CypherPotato/open-indexer-docs/blob/master/docs/en/entities/functions.md/#L1" class="edit-link">Edit this page</a>
                </div>

                <div class="next-article d-print-none border-top" id="nextArticle"></div>

            </div>

            <div class="affix">
                <nav id="affix"></nav>
            </div>
        </main>

        <div class="container-xxl search-results" id="search-results"></div>

        <footer class="border-top text-secondary">
            <div class="container-xxl">
                <div class="flex-fill">
                    <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
                </div>
            </div>
            <script>
                if (window.location.pathname.startsWith('/docs/')) {
                    document.getElementById('language-wrapper').style.display = 'block';
                }
                
                function splitText(text, words) {
                    if (!Array.isArray(words)) return [];
                    const escapedWords = words.map(word =>
                        word.replace(/([.*+?^${}()|[\]\\])/g, '\\$1').replace(/\s/g, '\\$&'));
                        
                    escapedWords.sort((a, b) => b.length - a.length || b.localeCompare(a, 'en-US', { sensitivity: 'base' }));
                    const pattern = new RegExp(`\\b(${escapedWords.join('|')})\\b`, 'gi');
                    const splitResult = text.split(pattern);
                    const cleanedResult = splitResult.filter(segment => segment !== '');
                    return cleanedResult;
                }
                
                function runPostHljsFunctions() {
                    if (!document.querySelector("pre>code")) {
                        return;
                    }
                    if (!document.querySelector(".hljs")) {
                        setTimeout(runPostHljsFunctions, 100);
                        return;
                    }
                    
                    function highlightMissingCodeTokens(pre) {
                        const tokenClasses = [
                            "HttpResponse", "HttpRequest", "File", "Task",
                            "Router", "Route", "StringContent", "StreamContent",
                            "JsonContent", "RegexRoute", "HtmlContent", "CancellationTokenSource",
                            "HttpContext", "Stream", "MultipartObject", "Thread", "Task", "Encoding",
                            "HttpKnownHeaderNames", "HttpMethod", "List", "JsonSerializer",
                            "LogStream", "HttpServer", "RotatingLogPolicy", "StringBuilder",
                            "Console", "HttpRequestEventSource", "HttpWebSocket", "X509Certificate2",
                            "AppDomain", "Path", "Directory", "HttpServerConfiguration", "ListeningHost",
                            "ByteArrayContent", "ForwardingResolver", "IPAddress", "IPEndPoint",
                            "HttpServerExecutionResult", "ArgumentNullException", "JsonSerializerOptions",
                            "DbContext"
                        ];
                        const tokenValues = [
                            "RouteMethod", "Guid", "RequestHandlerExecutionMode", "HttpStatusCode",
                            "HttpStatusInformation", "DateTime", "TimeSpan", "RouterMethod",
                            "ListeningPort"
                        ];
                        const tokenInterfaces = [
                            "IRequestHandler", "IEnumerable", "ICollection", "IList"
                        ];
                        
                        function runStyles(node) {
                            if (node.nodeType === 3) {
                                applyStyles(node);
                                
                            } else if (node.nodeType === 1) {
                                
                                const prohibitedClasses = ["hljs-comment", "hljs-string"];
                                
                                if (! prohibitedClasses.some(cls => node.classList.contains(cls))) {
                                    for(const child of node.childNodes) {
                                        runStyles(child);
                                    }
                                }
                            }
                        }
                        
                        function applyStyles(textNode) {
                            const text = textNode.textContent;
                            const fragment = [];
                            
                            for (const token of splitText(text, [...tokenClasses, ...tokenValues, ...tokenInterfaces])) {
                                if (tokenClasses.includes(token)) {
                                    fragment.push(el("span.hljs-meta", token));
                                    
                                } else if (tokenValues.includes(token)) {
                                    fragment.push(el("span.hljs-meta-value", token));
                                    
                                } else if (tokenInterfaces.includes(token)) {
                                    fragment.push(el("span.hljs-meta-interface", token));
                                    
                                } else {
                                    fragment.push(token);
                                }
                            }
                            
                            textNode.replaceWith(el.fragment(...fragment));
                        }
                        
                        const code = pre.querySelector("code");
                        if (code && (code.classList.contains("lang-csharp") || code.classList.contains("lang-cs"))) {
                            runStyles(code);
                        }
                    }
                    
                    function addLineNumbers(pre) {
                        const code = pre.querySelector("code");
                        if (!code) return;
                        
                        var lines = (code.textContent.match(/\n/g) || []).length;
                        
                        if (lines <= 1) {
                            return;
                        }
                        
                        const lineElements = [];
                        for (let i = 1; i <= lines; i++) {
                            lineElements.push(el("span.hljs-line-number", i + "\n"));
                        }
                        
                        code.prepend(el("div.line-numbers", ...lineElements));
                        code.classList.add("has-line-numbers");
                    }
                                        
                    document.querySelectorAll("pre").forEach(pre => {
                        highlightMissingCodeTokens(pre);
                        addLineNumbers(pre);
                    });
                }
                
                runPostHljsFunctions();
            </script>
        </footer>
    </body>
</html>