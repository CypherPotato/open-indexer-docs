<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Serverless Functions | AIVAX </title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="title" content="Serverless Functions | AIVAX ">


        <link rel="icon" href="../../assets/img/favicon.ico">
        <link rel="stylesheet" href="../../public/docfx.min.css">
        <link rel="stylesheet" href="../../public/main.css">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
        <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@100..900&family=Geist:wght@100..900&display=swap" rel="stylesheet">
        
        <link href="https://cdn.jsdelivr.net/npm/remixicon@4.6.0/fonts/remixicon.css" rel="stylesheet">

        <meta name="docfx:navrel" content="../../toc.html">
        <meta name="docfx:tocrel" content="toc.html">

        <meta name="docfx:rel" content="../../">


        <meta name="docfx:docurl" content="https://github.com/CypherPotato/open-indexer-docs/blob/master/docs/en/serverless.md/#L1">
        <meta name="loc:inThisArticle" content="In this article">
        <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
        <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
        <meta name="loc:tocFilter" content="Filter by title">
        <meta name="loc:nextArticle" content="Next">
        <meta name="loc:prevArticle" content="Previous">
        <meta name="loc:themeLight" content="Light">
        <meta name="loc:themeDark" content="Dark">
        <meta name="loc:themeAuto" content="Auto">
        <meta name="loc:changeTheme" content="Change theme">
        <meta name="loc:copy" content="Copy">
        <meta name="loc:downloadPdf" content="Download PDF">
        
        <script type="module" src="./../../public/docfx.min.js"></script>
        <script>
            const theme = localStorage.getItem('theme') || 'auto';
            document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
        </script>
        
        <script src="https://unpkg.com/@cypherpotato/el/dist/el.min.js"></script>
                
        <script>            
            function switchLanguage(lang) {
                const docPart = window.location.pathname.match(/\/docs\/((en)\/)?(.*)/)[3];
                const newPath = lang + docPart;
                window.location.href = window.location.origin + newPath;
            }        
        </script>
        
    </head>
    
    
    <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
        <header class="bg-body border-bottom">
            <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
                <div class="container-xxl flex-nowrap">
                    <a class="navbar-brand" href="../../index.html">
                        <img id="logo" class="svg" src="../../assets/img/aivax.png" alt="AIVAX">
                        AIVAX
                    </a>
                    <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
                        <i class="bi bi-three-dots"></i>
                    </button>
                    <div class="collapse navbar-collapse" id="navpanel">
                        <div id="navbar">
                            <form class="search" role="search" id="search">
                                <i class="bi bi-search"></i>
                                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
                            </form>
                        </div>
                    </div>
                </div>
            </nav>
        </header>

        <main class="container-xxl">
            <div class="toc-offcanvas">
                <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
                    <div class="offcanvas-header">
                        <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                        <nav class="toc" id="toc"></nav>
                    </div>
                </div>
            </div>

            <div class="content">
                <div class="actionbar">
                    <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
                        <i class="bi bi-list"></i>
                    </button>

                    <nav id="breadcrumb"></nav>

                    <div id="language-wrapper">
                        <a class="btn border-0 dropdown-toggle show" data-bs-toggle="dropdown" aria-expanded="true" title="Change theme">
                            <i class="bi bi-globe"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end language-dropdown">
                            <li>
                                <a class="dropdown-item" href="javascript:switchLanguage('/docs/')">
                                    <img src="/assets/flag/brazil.png">
                                    Português
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="javascript:switchLanguage('/docs/en/')">
                                    <img src="/assets/flag/usa.png">
                                    English
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <article data-uid="">
<h1 id="serverless-functions">Serverless Functions</h1>

<p>AIVAX's serverless functions allow you to run JavaScript on demand, in a managed environment, to create agentic endpoints without having to maintain servers.</p>
<p>Each request triggers the execution of your script, which reads data from the <code>req</code> object and writes the response to the <code>res</code> object.</p>
<h2 id="execution-flow-in-30-seconds">Execution flow in 30 seconds</h2>
<ul>
<li>Write an <code>async function main()</code>; it is called on each request.</li>
<li>Use <code>req</code> to read method, headers, query, and body.</li>
<li>Build the response with <code>res.status()</code>, <code>res.header()</code>, <code>res.text()</code> or <code>res.json()</code>.</li>
<li>Optionally, authenticate with <code>await authenticate()</code> and apply rate limiting with <code>rate_limit()</code>.</li>
<li>You can call models with <code>ai.complete(...)</code> or access internal APIs with <code>api.get/post/...</code>.</li>
</ul>
<div class="IMPORTANT">
<h5>Important</h5>
<p>No function is authenticated by default. Protect your endpoints by implementing your own logic or using <code>await authenticate()</code>.</p>
</div>
<h2 id="supported-global-objects">Supported global objects</h2>
<p>Below is the reference of objects and methods available in the environment, as implemented by the engine.</p>
<h3 id="console">console</h3>
<ul>
<li><code>log(...args)</code>/ <code>error(...args)</code> / <code>warn(...args)</code> / <code>info(...args)</code>
<ul>
<li>Writes to the debug console.</li>
<li>Strings/objects are serialized (objects via <code>JSON.stringify</code>).</li>
</ul>
</li>
<li><code>table(data, columns?)</code>
<ul>
<li>Arrays: prints a header row with <code>(index)</code> + columns. If <code>columns</code> is not provided, columns are inferred from the union of object keys in the array. Empty arrays print <code>(empty array)</code>.</li>
<li>Objects: lists <code>key: value</code> per line.</li>
<li>Other types: prints directly with <code>log</code>.</li>
</ul>
</li>
</ul>
<p>Notes</p>
<ul>
<li>For multiple arguments, <code>log</code> concatenates with a space. Objects are serialized with <code>JSON.stringify</code>.</li>
</ul>
<h3 id="fetchurl-options---promise">fetch(url, options?) -&gt; Promise<response></response></h3>
<ul>
<li><code>options.body</code>: <code>string</code>, <code>FormData</code> or <code>null</code>.</li>
<li><code>options.method</code>: HTTP method.</li>
<li><code>options.headers</code>: object with headers.</li>
<li><code>options.timeout</code>: integer (ms) request timeout.</li>
<li><code>options.redirect</code>: <code>follow</code> | <code>manual</code>.</li>
</ul>
<p>Response object:</p>
<ul>
<li><code>async text(): Promise&lt;string&gt;</code></li>
<li><code>async json(): Promise&lt;object&gt;</code></li>
<li><code>ok: boolean</code></li>
<li><code>status: number</code></li>
<li><code>statusText: string | null</code></li>
<li><code>headers: object</code></li>
<li><code>url: string</code></li>
</ul>
<p>Errors and notes</p>
<ul>
<li><code>Response.json()</code> throws if the body is not valid JSON.</li>
<li>The body is not a stream; read it with <code>text()</code> or <code>json()</code>.</li>
</ul>
<h3 id="req-request-reading">req (request reading)</h3>
<ul>
<li><code>headers: object</code> - request headers.</li>
<li><code>query: object</code> - query string parameters.</li>
<li><code>cookies: object</code> - present cookies.</li>
<li><code>method: string</code> - HTTP method.</li>
<li><code>path: string</code> - path without query.</li>
<li><code>fullPath: string</code> - path with query.</li>
<li><code>url: string</code> - full URL.</li>
<li><code>json(): any</code> - body as JSON.</li>
<li><code>text(): string</code> - body as text.</li>
<li><code>blob(): ArrayBuffer</code> - binary body.</li>
<li><code>form(): object</code> - simple form-data.</li>
<li><code>multipartForm(): object</code> - multipart form-data.</li>
</ul>
<p>Errors and notes</p>
<ul>
<li><code>req.json()</code> throws if the body is not valid JSON.</li>
</ul>
<h3 id="res-response-writing">res (response writing)</h3>
<ul>
<li><code>status(code: number): void</code> - sets HTTP status.</li>
<li><code>header(name: string, value: string): void</code> - adds a header.</li>
<li><code>text(body: string): void</code> - sets the response body as text.</li>
<li><code>json(data: any): void</code> - sets the response body as JSON.</li>
<li><code>error(message: string, status = 400): never</code> - sets status and body <code>{ error: message }</code> and immediately terminates script execution.</li>
</ul>
<p>Notes</p>
<ul>
<li>Only <code>res.error(...)</code> interrupts execution. After <code>res.text(...)</code> or <code>res.json(...)</code>, return from the function (<code>return</code>) if you want to avoid further processing.</li>
</ul>
<h3 id="ai-inference">ai (inference)</h3>
<ul>
<li><code>async complete(model, prompt, options?)</code>
<ul>
<li>Input
<ul>
<li><code>model: string</code> - name/slug/ID of the model or account gateway.</li>
<li><code>prompt: string | any[]</code> - text or array of messages (forwarded as <code>prompt</code>).</li>
<li><code>options?: object</code> - additional properties forwarded to the endpoint, merged into the body with <code>stream: false</code>.</li>
</ul>
</li>
<li>Return: JSON object of the response from the chat/completions endpoint.</li>
</ul>
</li>
<li><code>async completeText(model, prompt, options?)</code>
<ul>
<li>Return: <code>string</code> with the content of <code>choices[0].message.content</code> from the result of <code>complete</code>.</li>
</ul>
</li>
</ul>
<h3 id="api-authenticated-internal-http">api (authenticated internal HTTP)</h3>
<ul>
<li><code>async get(path)</code>
<ul>
<li>Return: response object with <code>text</code> (string) and <code>.json</code> property (getter) that parses <code>text</code> via <code>JSON.parse</code>.</li>
</ul>
</li>
<li><code>async post(path, body)</code>
<ul>
<li>Body is serialized with <code>JSON.stringify(body)</code>.</li>
<li>Return: same as <code>get</code>, with <code>.text</code> and getter <code>.json</code>.</li>
</ul>
</li>
<li><code>put(path, body)</code> / <code>patch(path, body)</code> / <code>delete(path)</code>
<ul>
<li>Return: promise for the raw internal result (without the <code>.json</code> getter).</li>
</ul>
</li>
</ul>
<p>Notes</p>
<ul>
<li><code>path</code> is relative to AIVAX's internal API.</li>
<li>The <code>.json</code> getter throws if <code>text</code> does not contain valid JSON.</li>
</ul>
<h3 id="helpers">Helpers</h3>
<ul>
<li><code>async authenticate(): Promise&lt;boolean&gt;</code> - validates the request with your account's API key.</li>
<li><code>sleep(ms: number): void</code> - waits the specified time in milliseconds (limited to 3 minutes).</li>
<li><code>rate_limit(threshold: number, seconds: number): void</code> - applies rate limiting per function and IP over the indicated period.</li>
</ul>
<hr>
<h2 id="practical-examples">Practical examples</h2>
<h3 id="1-hello-world">1) Hello World</h3>
<pre><code class="lang-js">async function main() {
    if (req.method !== 'GET') {
        res.status(405);
        return;
    }
    res.text('hello world');
}
</code></pre>
<h3 id="2-authentication--rate-limit--query-param">2) Authentication + rate limit + query param</h3>
<pre><code class="lang-js">async function main() {
    if (!await authenticate()) {
        res.status(403);
        return;
    }

    rate_limit(10, 60); // up to 10 requests per IP every 60s

    if (req.method !== 'GET') {
        res.status(405);
        return;
    }

    const city = req.query.q || res.error(&quot;'q' is required&quot;);
    res.json({ city });
}
</code></pre>
<h3 id="3-json-body-with-error-handling">3) JSON body with error handling</h3>
<pre><code class="lang-js">async function main() {
    let data;
    try {
        data = req.json();
    } catch {
        res.error('Invalid JSON', 400);
    }

    // use the payload
    res.json({ received: data });
}
</code></pre>
<h3 id="4-ai-call-direct-text">4) AI call (direct text)</h3>
<pre><code class="lang-js">async function main() {
    if (!await authenticate()) {
        res.status(403);
        return;
    }

    const prompt = req.query.p || 'Say hello briefly.';
    const text = await ai.completeText('@metaai/llama-4-scout-17b-16e', prompt, { temperature: 0.7 });
    res.text(text);
}
</code></pre>
<h3 id="5-full-example-json-function">5) Full example (JSON function)</h3>
<pre><code class="lang-js">async function main() {
    if (!await authenticate()) {
        res.status(403);
        return;
    }

    rate_limit(10, 60);

    if (req.method !== 'GET') {
        res.status(405);
        return;
    }

    const cityName = req.query.q || res.error(&quot;'q' is required&quot;);

    const weather = await api.post('/api/v1/functions/json', {
        modelName: '@x-ai/grok-4-fast',
        prompt: 'Search weather data for the given city.',
        responseSchema: {
            type: 'object',
            properties: {
                temperature: { type: 'number', description: 'Temperature in °C' },
                forecast: { type: 'string', enum: ['rainy', 'thunder', 'clear'] }
            },
            required: ['temperature', 'forecast']
        },
        inputData: { cityName }
    });

    res.json(weather.json.data.result);
}
</code></pre>
<h3 id="6-sleep-controlled-wait">6) Sleep (controlled wait)</h3>
<pre><code class="lang-js">async function main() {
    // wait 200 ms
    sleep(200);
    res.text('ok');
}
</code></pre>
<h2 id="engine-limitations">Engine limitations</h2>
<p>Functions run in an isolated JavaScript container with the following restrictions:</p>
<ul>
<li>Maximum memory per execution: 32 MB.</li>
<li>Maximum execution time per script: 5 minutes.</li>
<li>Maximum evaluation time for RegExp expressions: 10 seconds.</li>
<li>Maximum response size read by <code>fetch</code>: 10 MB (except internal AIVAX calls).</li>
</ul>
<div class="TIP">
<h5>Tip</h5>
<p>Handle user input, validate methods/headers and use <code>res.error()</code> for consistent error responses. Prefer <code>rate_limit()</code> on public endpoints.</p>
</div>
<h2 id="pricing">Pricing</h2>
<p>Billing is done per execution hour. Each call accumulates milliseconds only from the script's execution time (does not include compilation). E.g., if the script takes 20 seconds, 20,000 ms will be counted. The minimum charge per execution is 20 ms.</p>
<p>The serverless processing cost is <strong>$1/hour</strong>.</p>
<div class="NOTE">
<h5>Note</h5>
<p>All accounts have <strong>10 minutes</strong> free per day. Once exceeded, billing starts. If the account goes negative, function execution is halted.</p>
</div>
<h2 id="rate-limits">Rate limits</h2>
<p>The global rate limits for serverless functions are described in <a href="/docs/en/limits">rate limits</a>.</p>

</article>

                <div class="contribution d-print-none">
                    <a href="https://github.com/CypherPotato/open-indexer-docs/blob/master/docs/en/serverless.md/#L1" class="edit-link">Edit this page</a>
                </div>

                <div class="next-article d-print-none border-top" id="nextArticle"></div>

            </div>

            <div class="affix">
                <nav id="affix"></nav>
            </div>
        </main>

        <div class="container-xxl search-results" id="search-results"></div>

        <footer class="border-top text-secondary">
            <div class="container-xxl">
                <div class="flex-fill">
                    <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
                </div>
            </div>
            <script>
                if (window.location.pathname.startsWith('/docs/')) {
                    document.getElementById('language-wrapper').style.display = 'block';
                }
                
                function splitText(text, words) {
                    if (!Array.isArray(words)) return [];
                    const escapedWords = words.map(word =>
                        word.replace(/([.*+?^${}()|[\]\\])/g, '\\$1').replace(/\s/g, '\\$&'));
                        
                    escapedWords.sort((a, b) => b.length - a.length || b.localeCompare(a, 'en-US', { sensitivity: 'base' }));
                    const pattern = new RegExp(`\\b(${escapedWords.join('|')})\\b`, 'gi');
                    const splitResult = text.split(pattern);
                    const cleanedResult = splitResult.filter(segment => segment !== '');
                    return cleanedResult;
                }
                
                function runPostHljsFunctions() {
                    if (!document.querySelector("pre>code")) {
                        return;
                    }
                    if (!document.querySelector(".hljs")) {
                        setTimeout(runPostHljsFunctions, 100);
                        return;
                    }
                    
                    function highlightMissingCodeTokens(pre) {
                        const tokenClasses = [
                            "HttpResponse", "HttpRequest", "File", "Task",
                            "Router", "Route", "StringContent", "StreamContent",
                            "JsonContent", "RegexRoute", "HtmlContent", "CancellationTokenSource",
                            "HttpContext", "Stream", "MultipartObject", "Thread", "Task", "Encoding",
                            "HttpKnownHeaderNames", "HttpMethod", "List", "JsonSerializer",
                            "LogStream", "HttpServer", "RotatingLogPolicy", "StringBuilder",
                            "Console", "HttpRequestEventSource", "HttpWebSocket", "X509Certificate2",
                            "AppDomain", "Path", "Directory", "HttpServerConfiguration", "ListeningHost",
                            "ByteArrayContent", "ForwardingResolver", "IPAddress", "IPEndPoint",
                            "HttpServerExecutionResult", "ArgumentNullException", "JsonSerializerOptions",
                            "DbContext"
                        ];
                        const tokenValues = [
                            "RouteMethod", "Guid", "RequestHandlerExecutionMode", "HttpStatusCode",
                            "HttpStatusInformation", "DateTime", "TimeSpan", "RouterMethod",
                            "ListeningPort"
                        ];
                        const tokenInterfaces = [
                            "IRequestHandler", "IEnumerable", "ICollection", "IList"
                        ];
                        
                        function runStyles(node) {
                            if (node.nodeType === 3) {
                                applyStyles(node);
                                
                            } else if (node.nodeType === 1) {
                                
                                const prohibitedClasses = ["hljs-comment", "hljs-string"];
                                
                                if (! prohibitedClasses.some(cls => node.classList.contains(cls))) {
                                    for(const child of node.childNodes) {
                                        runStyles(child);
                                    }
                                }
                            }
                        }
                        
                        function applyStyles(textNode) {
                            const text = textNode.textContent;
                            const fragment = [];
                            
                            for (const token of splitText(text, [...tokenClasses, ...tokenValues, ...tokenInterfaces])) {
                                if (tokenClasses.includes(token)) {
                                    fragment.push(el("span.hljs-meta", token));
                                    
                                } else if (tokenValues.includes(token)) {
                                    fragment.push(el("span.hljs-meta-value", token));
                                    
                                } else if (tokenInterfaces.includes(token)) {
                                    fragment.push(el("span.hljs-meta-interface", token));
                                    
                                } else {
                                    fragment.push(token);
                                }
                            }
                            
                            textNode.replaceWith(el.fragment(...fragment));
                        }
                        
                        const code = pre.querySelector("code");
                        if (code && (code.classList.contains("lang-csharp") || code.classList.contains("lang-cs"))) {
                            runStyles(code);
                        }
                    }
                    
                    function addLineNumbers(pre) {
                        const code = pre.querySelector("code");
                        if (!code) return;
                        
                        var lines = (code.textContent.match(/\n/g) || []).length;
                        
                        if (lines <= 1) {
                            return;
                        }
                        
                        const lineElements = [];
                        for (let i = 1; i <= lines; i++) {
                            lineElements.push(el("span.hljs-line-number", i + "\n"));
                        }
                        
                        code.prepend(el("div.line-numbers", ...lineElements));
                        code.classList.add("has-line-numbers");
                    }
                                        
                    document.querySelectorAll("pre").forEach(pre => {
                        highlightMissingCodeTokens(pre);
                        addLineNumbers(pre);
                    });
                }
                
                runPostHljsFunctions();
            </script>
        </footer>
    </body>
</html>